{% extends "base.html" %}
{% block title %}Torneos{% endblock %}
{% block content %}
  <div style="display:flex; align-items:center; gap:10px; margin-bottom:8px; flex-wrap:wrap;">
    <h2 style="margin:0;">Torneos</h2>
    <div style="display:flex; gap:6px; flex-wrap:wrap;">
      {# helper para clase activa #}
      {% set est = (estado or '')|upper %}
      <a class="btn btn-ghost btn-slim {% if not est %}active{% endif %}"
         href="{{ url_for('torneos_public_list') }}">Todos</a>
      <a class="btn btn-ghost btn-slim {% if est == 'INSCRIPCION' %}active{% endif %}"
         href="{{ url_for('torneos_public_list', estado='INSCRIPCION') }}">Inscripción</a>
      <a class="btn btn-ghost btn-slim {% if est == 'EN_JUEGO' %}active{% endif %}"
         href="{{ url_for('torneos_public_list', estado='EN_JUEGO') }}">En juego</a>
      <a class="btn btn-ghost btn-slim {% if est == 'FINALIZADO' %}active{% endif %}"
         href="{{ url_for('torneos_public_list', estado='FINALIZADO') }}">Finalizados</a>
    </div>
  </div>

  {% if torneos|length == 0 %}
    <div class="card"><p style="margin:0;">No hay torneos{{ ' en estado ' + estado if estado else '' }}.</p></div>
  {% else %}
    <div class="card" style="padding:0;">
      <table class="table">
        <thead>
          <tr>
            <th>Nombre</th>
            <th>Modalidad</th>  {# Individual / Parejas (SINGLES/DOBLES) #}
            <th>Formato</th>    {# Tipo: AMERICANO / ZONAS + PLAYOFF / PLAYOFF #}
            <th>Categoría</th>
            <th>Estado</th>
            <th>Inicio</th>
            <th>Público</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          {% for t in torneos %}
            {# Modalidad humana: prioriza t.modalidad; si está vacío, usa t.formato como fallback #}
            {% set raw_mod = (t.modalidad or t.formato or '') %}
            {% set mod_up = raw_mod.upper() %}
            {% set modalidad_humana = 'INDIVIDUAL' if mod_up == 'SINGLES'
                                      else 'PAREJAS' if mod_up == 'DOBLES'
                                      else (raw_mod or '-') %}

            {# Formato humano desde t.tipo #}
            {% set tipo_up = (t.tipo or '')|upper %}
            {% set formato_humano = 'AMERICANO' if tipo_up == 'AMERICANO'
                                   else 'ZONAS Y PLAYOFF' if tipo_up in ['ZONAS+PLAYOFF','ZONAS + PLAYOFF']
                                   else 'PLAYOFF' if tipo_up == 'PLAYOFF'
                                   else (t.tipo or '-') %}

            <tr>
              <td>{{ t.nombre }}</td>
              <td>{{ modalidad_humana }}</td>
              <td>{{ formato_humano }}</td>
              <td>{{ t.categoria.nombre if t.categoria else '-' }}</td>
              <td><span class="badge">{{ t.estado }}</span></td>
              <td>{{ t.fecha_inicio or '-' }}</td>
              <td>
                {% if t.es_publico %}
                  <span class="badge">Público</span>
                {% else %}
                  <span class="badge">Privado</span>
                {% endif %}
              </td>
              <td>
                <a class="btn btn-ghost btn-slim"
                   href="{{ url_for('torneo_public_detail', torneo_id=t.id) }}">
                  Ver
                </a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% endif %}
{% endblock %}
