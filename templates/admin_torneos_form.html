{% extends "base.html" %}
{% block title %}Nuevo torneo{% endblock %}
{% block content %}
  <div style="display:flex; align-items:center; gap:10px; margin-bottom:8px;">
    <h2 style="margin:0;">Nuevo torneo</h2>
    <a href="{{ url_for('admin_torneos_list') }}" class="btn btn-ghost btn-slim">Volver</a>
  </div>

  <div class="card" style="max-width:680px;">
    <form method="post" style="display:grid; gap:10px;">
      <div>
        <label class="muted" for="nombre" style="display:block; margin-bottom:4px;">Nombre</label>
        <input id="nombre" name="nombre" required placeholder="Ej: Torneo Primavera" style="width:100%;">
      </div>

      <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(220px,1fr)); gap:10px;">
        <div>
          <label class="muted" for="modalidad" style="display:block; margin-bottom:4px;">Modalidad</label>
          <select id="modalidad" name="modalidad" required>
            <option value="SINGLES">INDIVIDUAL</option>
            <option value="DOBLES">PAREJAS</option>
          </select>
        </div>
        <div>
          <label class="muted" for="formato" style="display:block; margin-bottom:4px;">Formato</label>
          <select id="formato" name="formato" required>
            <option value="AMERICANO">AMERICANO</option>
            <option value="ZONAS+PLAYOFF">ZONAS + PLAYOFF</option>
            <option value="PLAYOFF">PLAYOFF</option>
          </select>
        </div>
        <div>
          <label class="muted" for="categoria_id" style="display:block; margin-bottom:4px;">Categoría (opcional)</label>
          <select id="categoria_id" name="categoria_id">
            <option value="">— Sin categoría fija —</option>
            {% for c in categorias %}
              <option value="{{ c.id }}">{{ c.nombre }} ({{ c.puntos_min }}–{{ c.puntos_max }})</option>
            {% endfor %}
          </select>
        </div>
      </div>

      <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(220px,1fr)); gap:10px;">
        <div id="wrap_limite_jug">
          <label class="muted" for="limite_jugadores" style="display:block; margin-bottom:4px;">Límite de jugadores (solo Individual)</label>
          <input id="limite_jugadores" name="limite_jugadores" type="number" min="2" placeholder="Ej: 16" style="width:100%;">
        </div>
        <div id="wrap_limite_par">
          <label class="muted" for="limite_parejas" style="display:block; margin-bottom:4px;">Límite de parejas (solo Parejas)</label>
          <input id="limite_parejas" name="limite_parejas" type="number" min="2" placeholder="Ej: 16" style="width:100%;">
        </div>
        <div>
          <label class="muted" for="fecha_inicio" style="display:block; margin-bottom:4px;">Fecha inicio (opcional)</label>
          <input id="fecha_inicio" name="fecha_inicio" type="date" style="width:100%;">
        </div>
      </div>

      <div>
        <label class="muted" for="sede" style="display:block; margin-bottom:4px;">Sede (opcional)</label>
        <input id="sede" name="sede" placeholder="Club, ciudad…" style="width:100%;">
      </div>

      <div>
        <label class="muted" for="notas" style="display:block; margin-bottom:4px;">Notas (opcional)</label>
        <textarea id="notas" name="notas" rows="3" style="width:100%;" placeholder="Detalles, reglas, etc."></textarea>
      </div>

      <div style="display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-top:4px;">
        <button type="submit" class="btn">Crear torneo</button>
        <a href="{{ url_for('admin_torneos_list') }}" class="btn btn-ghost">Cancelar</a>
      </div>
    </form>
  </div>

  <script>
    // Mostrar/ocultar límites según modalidad (los values siguen siendo SINGLES/DOBLES)
    const modalidad = document.getElementById('modalidad');
    const wrapJug = document.getElementById('wrap_limite_jug');
    const wrapPar = document.getElementById('wrap_limite_par');

    function syncLimites(){
      const m = (modalidad.value || '').toUpperCase();
      if (m === 'SINGLES') { wrapJug.style.display = ''; wrapPar.style.display = 'none'; }
      else { wrapJug.style.display = 'none'; wrapPar.style.display = ''; }
    }
    modalidad?.addEventListener('change', syncLimites);
    syncLimites();
  </script>
{% endblock %}
