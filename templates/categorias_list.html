{% extends "base.html" %}
{% block title %}Categorías{% endblock %}

{% block content %}
  <h2>Categorías</h2>

  {# Botón visible solo para admins #}
  {% if current_jugador and current_jugador.is_admin %}
    <p>
      <a href="{{ url_for('categorias_new') }}">
        <button>Nueva categoría</button>
      </a>
    </p>
  {% endif %}

  {% if categorias %}
    <table>
      <thead>
        <tr><th>Nombre</th><th>Rango de puntos</th><th>Creada</th></tr>
      </thead>
      <tbody>
        {% for c in categorias %}
          <tr>
            <td>{{ c.nombre }}</td>
            <td>{{ c.puntos_min }} – {{ c.puntos_max }}</td>
            <td>{{ c.creada_en.strftime('%Y-%m-%d %H:%M') }}</td>
            {# Alternativa con tu filtro: {{ c.creada_en|localdt('%Y-%m-%d %H:%M') }} #}
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p>No hay categorías cargadas.</p>
  {% endif %}
{% endblock %}

{% block help_content %}
<style>
  /* ==== Modal de ayuda: contenedor BAJO y scroll en el contenedor (igual que index) ==== */
  .help-container{ display:flex; justify-content:center; width:100%; }
  .help-wrap{
    width: min(800px, 90vw);
    margin: 0 auto;

    /* Altura reducida + scroll único del modal */
    max-height: 62dvh;   /* si tu modal padre ocupa más, bajar a 60dvh/58dvh */
    max-height: 62vh;    /* fallback */
    overflow: auto;
    overscroll-behavior: contain;

    position: relative;
    background: transparent;
  }

  /* Encabezado compacto y sticky */
  .help-head{
    position: sticky; top: 0; z-index: 2;
    display:flex; align-items:center; gap:6px;
    padding:6px 6px; margin-bottom:4px;
    background: var(--bg, rgba(10,12,20,.96));
    border-bottom:1px solid rgba(255,255,255,.06);
  }
  .help-title{ margin:0; font-size: clamp(.92rem, 2vw, 1.02rem); }
  .help-sub{   margin:0; color:var(--muted,#98a2b3); font-size: clamp(.78rem, 1.7vw, .88rem); }

  /* Grilla sin desbordes */
  .help-grid{
    display:grid;
    grid-template-columns: repeat(auto-fit, minmax(236px, 1fr));
    gap:8px;
  }

  /* Tarjetas y texto compactos */
  .help-card{
    background: rgba(255,255,255,.04);
    border:1px solid rgba(255,255,255,.08);
    border-radius:10px;
    padding:6px;
  }
  .help-card h4{
    display:flex; align-items:center; gap:6px;
    margin:0 0 4px;
    font-size: clamp(.88rem, 1.9vw, .96rem);
  }
  .help-card p, .help-card li{
    margin:3px 0;
    font-size: clamp(.78rem, 1.6vw, .86rem);
    line-height:1.3;
  }
  .help-ul, .help-ol{ padding-left:16px; margin:4px 0; }

  .chip{ display:inline-block; padding:2px 7px; border-radius:999px; font-size:.76rem; border:1px solid #2a2f45; background:#1b2138; margin-right:6px;}
  .chip.ok{ background:#1b3b2a; border-color:#1a704d;}
  .chip.info{ background:#1b2f3b; border-color:#1a4d70;}
  .chip.warn{ background:#3b2f1b; border-color:#704d1a;}

  .help-visual{
    display:flex; align-items:center; justify-content:center;
    background: rgba(255,255,255,.03);
    border:1px dashed rgba(255,255,255,.12);
    border-radius:10px; padding:6px;
  }
  .help-visual svg, .help-card img{ max-width:100%; height:auto; display:block; }

  @media (max-width:540px){
    .help-grid{ grid-template-columns: 1fr; }
    .help-card h4 svg{ display:none; }
  }
</style>

<div class="help-container">
  <div class="help-wrap">
    <div class="help-head">
      <h3 class="help-title">¿Cómo leer y gestionar categorías?</h3>
      <p class="help-sub">Guía rápida y visual</p>
    </div>

    <div class="help-grid">
      <!-- ¿Qué estás viendo? (todos) -->
      <section class="help-card">
        <h4>
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M3 7h18v10H3z" stroke="currentColor"/><path d="M8 7V5a4 4 0 118 0v2" stroke="currentColor"/>
          </svg>
          ¿Qué estás viendo?
        </h4>
        <p>Un listado de <strong>categorías</strong> con su <strong>rango de puntos</strong>. El sistema usa estos rangos para desafíos, abiertos y zona de ascenso.</p>
        <div>
          <span class="chip info">Nombre</span>
          <span class="chip ok">Puntos mínimos</span>
          <span class="chip warn">Puntos máximos</span>
        </div>
      </section>

      <!-- Columnas (todos) -->
      <section class="help-card">
        <h4>
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M4 6h16M4 12h10M4 18h8" stroke="currentColor"/></svg>
          Columnas
        </h4>
        <ul class="help-ul">
          <li><strong>Nombre</strong>: etiqueta visible (ej.: <em>7ma Mixta</em>).</li>
          <li><strong>Rango de puntos</strong>: <em>mín–máx</em> que define pertenencia.</li>
          <li><strong>Creada</strong>: fecha y hora de alta.</li>
        </ul>
      </section>

      <!-- Visual del rango (todos) -->
      <section class="help-card">
        <h4>
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="9" stroke="currentColor"/></svg>
          Ejemplo visual del rango
        </h4>
        <div class="help-visual">
          <svg width="260" height="110" viewBox="0 0 280 120" aria-hidden="true">
            <rect x="20" y="58" width="240" height="6" rx="3" fill="#475569"/>
            <rect x="60" y="50" width="160" height="22" rx="6" fill="#1b3b2a" stroke="#1a704d"/>
            <text x="140" y="64" fill="#fff" font-size="11" text-anchor="middle">600 ↔ 699</text>
            <text x="20" y="45" fill="#9aa3b2" font-size="10">0</text>
            <text x="140" y="45" fill="#9aa3b2" font-size="10">600</text>
            <text x="220" y="45" fill="#9aa3b2" font-size="10">699</text>
          </svg>
        </div>
        <p class="muted" style="margin-top:4px;">Ejemplo: <strong>7ma Mixta</strong> con rango 600–699.</p>
      </section>

      {# ---- SOLO ADMIN ---- #}
      {% if current_jugador and current_jugador.is_admin %}
        <section class="help-card">
          <h4>
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M6 6h12v12H6z" stroke="currentColor"/></svg>
            Impacto en el sistema (admin)
          </h4>
          <ul class="help-ul">
            <li>Los <strong>desafíos inter-nivel</strong> usan la <em>categoría superior</em> del desafiante.</li>
            <li>La <strong>zona de ascenso</strong> se calcula con respecto al <em>mínimo</em> de la categoría.</li>
            <li>Los <strong>partidos abiertos</strong> se crean y filtran por categoría.</li>
          </ul>
        </section>

        <section class="help-card">
          <h4>
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 2l3 7h7l-5.5 4 2 7-6.5-4.5L5 20l2-7L1 9h7l4-7z" stroke="currentColor"/></svg>
            Buenas prácticas (admin)
          </h4>
          <ul class="help-ul">
            <li>Evitá <strong>solapamientos</strong> entre rangos.</li>
            <li>Mantené <strong>contigüidad</strong> (sin huecos) y nombres consistentes.</li>
            <li>Antes de crear, revisá la lista para no duplicar.</li>
          </ul>
        </section>

        <section class="help-card">
          <h4>
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 2v20M2 12h20" stroke="currentColor"/></svg>
            Acciones rápidas (admin)
          </h4>
          <ul class="help-ul">
            <li><strong>Nueva categoría</strong>: definí nombre y rango min–max.</li>
            <li>Si ajustás rangos, evaluá su efecto en desafíos y abiertos.</li>
          </ul>
          <div class="help-actions" style="display:flex; gap:8px; flex-wrap:wrap;">
            <a href="{{ url_for('categorias_new') }}" class="btn btn-ghost btn-slim">➕ Nueva categoría</a>
          </div>
        </section>
      {% endif %}
      {# ---- /SOLO ADMIN ---- #}
    </div>
  </div>
</div>
{% endblock %}
