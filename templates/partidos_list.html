{% extends "base.html" %}
{% block title %}Partidos{% endblock %}
{% block content %}
<style>
  /* ===== Hero / cabecera (igual que Inicio) ===== */
  .hero{
    position:relative; overflow:hidden;
    border-radius:16px; padding:14px;
    background:
      radial-gradient(700px 260px at 0% 0%, rgba(138,232,12,.25), transparent 60%),
      radial-gradient(700px 260px at 100% 100%, rgba(246,201,14,.18), transparent 60%),
      linear-gradient(180deg, rgba(0,0,0,.22), rgba(0,0,0,.10));
    border:1px solid rgba(255,255,255,.12);
    box-shadow:0 14px 40px rgba(0,0,0,.28);
    margin-bottom:10px;
  }
  .hero-top{
    display:flex; gap:12px; align-items:flex-end; justify-content:space-between; flex-wrap:wrap;
  }
  .hero-title{ margin:0; font-family:"Poppins",system-ui; font-weight:800; letter-spacing:.3px; }
  .hero-tag{
    margin:0; text-transform:uppercase; font-weight:800; letter-spacing:.14em; line-height:1;
    font-size:clamp(.78rem, 1.6vw, .92rem);
    background: linear-gradient(90deg, var(--yellow), var(--neon));
    -webkit-background-clip:text; background-clip:text; color:transparent;
    filter: drop-shadow(0 0 .15em rgba(0,0,0,.25)); opacity:.95;
  }
  .hero-actions{display:flex; gap:10px; flex-wrap:wrap;}

  /* Chips de contexto */
  .chips{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px;}
  .chip{
    display:inline-flex; align-items:center; gap:8px;
    padding:6px 10px; border-radius:999px;
    background:rgba(255,255,255,.10); border:1px solid rgba(255,255,255,.16);
    font-weight:700;
  }
  .chip .dot{width:8px; height:8px; border-radius:50%;}
  .dot-green{background:var(--neon);} .dot-yellow{background:var(--yellow);} .dot-blue{background:#6EA8FF;}

  /* Botones coherentes */
  .btn-ghost{ background:transparent; border:1px solid rgba(255,255,255,.22); }
  .btn-slim{ padding:6px 10px; border-radius:10px; font-weight:800; }
  .btn-ok{ background:#1a704d; color:#fff; }
  .btn-danger{ background:#6d1a1a; color:#fff; }

  /* ===== Tabla en card ===== */
  .card{
    border-radius:14px; border:1px solid rgba(255,255,255,.12);
    background:linear-gradient(180deg, var(--panel), var(--panel-2));
  }
  .card.pad-0{ padding:0; }
  .card-body{ padding:10px; }
  .muted{ color:var(--muted,#98a2b3); }
  .table-wrap{
    --thead-h: 44px;
    max-height:70vh; overflow:auto; border-radius:12px;
    mask-image: linear-gradient(to bottom, rgba(0,0,0,1) 90%, rgba(0,0,0,0));
  }
  table.list{
    width:100%; border-collapse:separate; border-spacing:0; margin:0;
  }
  thead th{
    position:sticky; top:0; z-index:3;
    background:#0d1b2a; color:#dbe2ef; text-align:left;
    padding:10px 8px; height:var(--thead-h); line-height:1.1;
    text-transform:uppercase; letter-spacing:.02em; font-size:.86rem;
    box-shadow:0 2px 0 rgba(0,0,0,.25);
  }
  tbody td{ padding:10px 8px; border-bottom:1px solid rgba(255,255,255,.06); vertical-align:middle; }
  tbody tr:nth-child(odd){ background:rgba(255,255,255,.02); }
  tbody tr:hover{ background:rgba(138,232,12,.05); }

  /* Badges */
  .badge{ display:inline-block; padding:2px 8px; border-radius:999px; font-size:.8rem;
          background:rgba(255,255,255,.12); border:1px solid rgba(255,255,255,.18); }
  .badge-ok{ background:#153c2a; border-color:#2a8b5f; }
  .badge-warn{ background:#3b2f1b; border-color:#704d1a; }
  .badge-danger{ background:#6d1a1a; border-color:#9c2a2a; }

  /* Tooltip mínimo (el tuyo) */
  .hint-chip{ position:relative; display:inline-block; cursor:help; }
  .hint-chip::after{
    content: attr(data-hint);
    position:absolute; left:0; top:calc(100% + 6px);
    background:#111; color:#fff; border-radius:8px; padding:8px 10px;
    box-shadow:0 6px 18px rgba(0,0,0,.35);
    font-size:.9em; white-space:pre-wrap; max-width:380px; line-height:1.25;
    opacity:0; transform:translateY(-4px); pointer-events:none; transition:.15s ease;
    z-index:9999;
  }
  .hint-chip:hover::after, .hint-chip:focus-within::after{ opacity:1; transform:translateY(0); }

  /* Responsive: ajustar columnas */
  @media (max-width:900px){
    thead th:nth-child(7), tbody td:nth-child(7){ display:none; } /* Creado */
  }
  @media (max-width:720px){
    thead th:nth-child(6), tbody td:nth-child(6){ display:none; } /* Resultado / Cancha */
  }
</style>

<!-- ===== HERO ===== -->
<div class="hero">
  <div class="hero-top">
    <div>
      <h1 class="hero-title">Partidos</h1>
      <p class="hero-tag">Tus partidos y de torneo</p>
    </div>
    <div class="hero-actions">
      <a href="{{ url_for('partidos_new') }}" class="btn">Nuevo partido</a>
      <a href="{{ url_for('abiertos_list') }}" class="btn-ghost btn-slim">Ver abiertos</a>
    </div>
  </div>

  <!-- Chips de contexto -->
  <div class="chips">
    <span class="chip"><span class="dot dot-blue"></span>Total: {{ partidos|length if partidos else 0 }}</span>
    {% if current_jugador %}
      <span class="chip"><span class="dot dot-yellow"></span>Yo: {{ current_jugador.nombre_completo }}</span>
      {% if current_jugador.categoria %}<span class="chip">Cat: {{ current_jugador.categoria.nombre }}</span>{% endif %}
    {% endif %}
  </div>
</div>

{# =======================
   SECCIÓN 1: TUS PARTIDOS
   ======================= #}
{% if partidos and partidos|length > 0 %}
  <div class="card pad-0">
    <div class="card-body">
      <p class="muted" style="margin:0 0 8px;">Tip: pasá el mouse por el chip <em>falta aceptación</em> para ver quiénes faltan.</p>
    </div>
    <div class="table-wrap">
      <table class="list">
        <thead>
          <tr>
            <th>Categoría</th>
            <th>Pareja 1</th>
            <th>Pareja 2</th>
            <th>Fecha</th>
            <th>Estado</th>
            <th>Resultado</th>
            <th>Creado</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for m in partidos %}
            {# ---- Normalización segura ---- #}
            {% set cj = current_jugador if current_jugador is defined else None %}
            {% set r1_ok = (m.rival1_acepto in [True, 1, '1']) %}
            {% set r2_ok = (m.rival2_acepto in [True, 1, '1']) %}
            {% set ambos_aceptaron = r1_ok and r2_ok %}
            {% set hay_propuesta = (m.resultado_propuesto_ganador_pareja_id is not none) %}

            {% set soy_participante = cj and (
              cj.id in [
                m.pareja1.jugador1_id, m.pareja1.jugador2_id,
                m.pareja2.jugador1_id, m.pareja2.jugador2_id
              ]
            ) %}
            {% set soy_pareja1 = cj and (cj.id in [m.pareja1.jugador1_id, m.pareja1.jugador2_id]) %}
            {% set soy_pareja2 = cj and (cj.id in [m.pareja2.jugador1_id, m.pareja2.jugador2_id]) %}
            {% set debo_confirmar = (
              hay_propuesta and soy_participante and
              ((soy_pareja1 and not m.confirmo_pareja1) or (soy_pareja2 and not m.confirmo_pareja2))
            ) %}

            {% set requiere_inv = (m.rival1_id is not none and m.rival2_id is not none) %}
            {% set aceptacion_ok = (ambos_aceptaron if requiere_inv else True) %}

            {% set estado_ok = (m.estado in [
              'PENDIENTE','ACEPTADO','POR_CONFIRMAR','PROGRAMADO',
              'CONFIRMADO','EN_JUEGO','PROPUESTO','PARTIDO_CREADO'
            ]) %}

            {# Tooltips faltantes de invitación #}
            {% set faltan_aceptar = [] %}
            {% if m.estado == 'PENDIENTE' and requiere_inv and not ambos_aceptaron %}
              {% if (m.rival1_acepto is none or m.rival1_acepto in [False, 0, '0']) and m.rival1 %}{% set _ = faltan_aceptar.append(m.rival1.nombre_completo) %}{% endif %}
              {% if (m.rival2_acepto is none or m.rival2_acepto in [False, 0, '0']) and m.rival2 %}{% set _ = faltan_aceptar.append(m.rival2.nombre_completo) %}{% endif %}
            {% endif %}
            {% set faltan_aceptar_str = faltan_aceptar|join(', ') %}

            {# Tooltips faltantes de confirmación #}
            {% set faltan_confirmar = [] %}
            {% if hay_propuesta and not (m.confirmo_pareja1 and m.confirmo_pareja2) %}
              {% if not m.confirmo_pareja1 %}{% set _ = faltan_confirmar.append('Pareja 1 (' ~ m.pareja1.jugador1.nombre_completo ~ ' + ' ~ m.pareja1.jugador2.nombre_completo ~ ')') %}{% endif %}
              {% if not m.confirmo_pareja2 %}{% set _ = faltan_confirmar.append('Pareja 2 (' ~ m.pareja2.jugador1.nombre_completo ~ ' + ' ~ m.pareja2.jugador2.nombre_completo ~ ')') %}{% endif %}
            {% endif %}

            {% set hubo_rechazo = (not hay_propuesta) and (m.rechazo_ultimo_por_id is not none) and (m.estado == 'PENDIENTE') %}

            <tr>
              <td>{{ m.categoria.nombre if m.categoria else '-' }}</td>
              <td>{{ m.pareja1.jugador1.nombre_completo }} + {{ m.pareja1.jugador2.nombre_completo }}</td>
              <td>{{ m.pareja2.jugador1.nombre_completo }} + {{ m.pareja2.jugador2.nombre_completo }}</td>

              <td>{% if m.fecha %}{{ m.fecha|localdt('%Y-%m-%d %H:%M') }}{% else %}-{% endif %}</td>

              <td>
                <span class="badge
                  {% if m.estado == 'JUGADO' %}badge-ok
                  {% elif m.estado in ['PENDIENTE','PROPUESTO','POR_CONFIRMAR','ACEPTADO','PROGRAMADO','CONFIRMADO','EN_JUEGO'] %}badge-warn
                  {% elif m.estado in ['CANCELADO','EN_REVISION'] %}badge-danger
                  {% endif %}">
                  {{ m.estado }}
                </span>

                {% if m.estado == 'PENDIENTE' and requiere_inv and not ambos_aceptaron %}
                  <span
                    class="hint-chip badge badge-warn"
                    data-hint="{{ ('Faltan: ' ~ faltan_aceptar_str)|e }}"
                    title="{{ ('Faltan: ' ~ faltan_aceptar_str)|e }}"
                  >
                    falta aceptación
                  </span>
                {% endif %}

                {% if m.estado in ['PENDIENTE','PROPUESTO','ACEPTADO'] and hay_propuesta and not (m.confirmo_pareja1 and m.confirmo_pareja2) %}
                  <span
                    class="hint-chip badge"
                    data-hint="{{ ('Falta: ' ~ (faltan_confirmar|join(', ')))|e }}"
                    title="{{ ('Falta: ' ~ (faltan_confirmar|join(', ')))|e }}"
                  >
                    falta confirmación
                  </span>
                {% endif %}

                {% if hubo_rechazo %}
                  <span
                    class="hint-chip badge badge-danger"
                    data-hint="{{ ('Propuesta rechazada por ' ~ (m.rechazo_ultimo_por.nombre_completo if m.rechazo_ultimo_por else 'alguien') ~ ' el ' ~ (m.rechazo_ultimo_en|localdt('%Y-%m-%d %H:%M') if m.rechazo_ultimo_en else '-'))|e }}"
                    title="{{ ('Propuesta rechazada por ' ~ (m.rechazo_ultimo_por.nombre_completo if m.rechazo_ultimo_por else 'alguien') ~ ' el ' ~ (m.rechazo_ultimo_en|localdt('%Y-%m-%d %H:%M') if m.rechazo_ultimo_en else '-'))|e }}"
                  >
                    propuesta rechazada
                  </span>
                {% endif %}

                {% if m.estado in ['PENDIENTE','PROPUESTO','ACEPTADO'] and hay_propuesta and m.resultado_propuesto_en %}
                  <span
                    class="hint-chip badge autocierre-chip"
                    data-propuesto-ms="{{ m.resultado_propuesto_en|utcms }}"
                    data-hint=""
                    title=""
                  >
                    auto-cierra en …
                  </span>
                {% endif %}

                {% if hay_propuesta and (m.estado in ['PENDIENTE','PROPUESTO','ACEPTADO']) %}
                  <div class="muted" style="font-size:.9em; margin-top:4px;">
                    Propuesto:
                    {% if m.resultado_propuesto_ganador_pareja_id == m.pareja1_id %}
                      {{ m.pareja1.jugador1.nombre_completo }} + {{ m.pareja1.jugador2.nombre_completo }}
                    {% elif m.resultado_propuesto_ganador_pareja_id == m.pareja2_id %}
                      {{ m.pareja2.jugador1.nombre_completo }} + {{ m.pareja2.jugador2.nombre_completo }}
                    {% else %}
                      (pareja desconocida)
                    {% endif %}
                    {% if m.resultado_propuesto_sets_text %} — {{ m.resultado_propuesto_sets_text }}{% endif %}
                  </div>
                {% endif %}
              </td>

              <td>
                {% if m.estado == 'JUGADO' and m.resultado %}
                  {% set g = m.resultado.ganador_pareja_id %}
                  {% if g == m.pareja1_id %}
                    Ganó: {{ m.pareja1.jugador1.nombre_completo }} + {{ m.pareja1.jugador2.nombre_completo }}
                  {% elif g == m.pareja2_id %}
                    Ganó: {{ m.pareja2.jugador1.nombre_completo }} + {{ m.pareja2.jugador2.nombre_completo }}
                  {% else %}
                    Ganador no identificado
                  {% endif %}
                  {% if m.resultado.sets_text %} — {{ m.resultado.sets_text }}{% endif %}
                {% else %}
                  —
                {% endif %}
              </td>

              <td>{{ m.creado_en|localdt('%Y-%m-%d %H:%M') }}</td>

              <td style="white-space:nowrap;">
                {% if cj and m.estado == 'PENDIENTE' and requiere_inv and not ambos_aceptaron %}
                  {% set soy_rival1 = (cj.id == m.rival1_id) %}
                  {% set soy_rival2 = (cj.id == m.rival2_id) %}
                  {% if (soy_rival1 and not r1_ok) or (soy_rival2 and not r2_ok) %}
                    <a href="{{ url_for('partidos_responder', partido_id=m.id) }}" class="btn btn-slim">Responder invitación</a>
                  {% endif %}
                {% endif %}

                {% if aceptacion_ok and not hay_propuesta and estado_ok %}
                  {% if soy_participante or (cj and cj.is_admin) %}
                    <a href="{{ url_for('partidos_resultado', partido_id=m.id) }}" class="btn btn-slim" style="margin-left:6px;">
                      {% if hubo_rechazo %}Re-proponer resultado{% else %}Proponer resultado{% endif %}
                    </a>
                  {% endif %}
                {% endif %}

                {% if (m.estado in ['PENDIENTE','PROPUESTO','POR_CONFIRMAR','ACEPTADO']) and hay_propuesta and not (m.confirmo_pareja1 and m.confirmo_pareja2) %}
                  {% if debo_confirmar %}
                    <a href="{{ url_for('partidos_confirmar_resultado', partido_id=m.id) }}" class="btn btn-ok btn-slim" style="margin-left:6px;">Confirmar resultado</a>
                  {% elif soy_participante or (cj and cj.is_admin) %}
                    <a href="{{ url_for('partidos_confirmar_resultado', partido_id=m.id) }}" class="btn-ghost btn-slim" style="margin-left:6px;">Ver propuesta</a>
                  {% endif %}
                {% endif %}

                {% if cj and cj.is_admin %}
                  {% if m.estado == 'JUGADO' %}
                    <a href="{{ url_for('admin_partido_resultado_editar', partido_id=m.id) }}" class="btn-ghost btn-slim" style="margin-left:6px;">Editar resultado</a>
                  {% endif %}
                  <form method="post" action="{{ url_for('admin_partidos_eliminar', partido_id=m.id) }}" style="display:inline; margin-left:6px;">
                    <button type="submit" class="btn btn-danger btn-slim" onclick="return confirm('¿Eliminar este partido?')">Eliminar</button>
                  </form>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
{% else %}
  <div class="card">
    <div class="card-body">
      <p class="muted" style="margin:0;">Esta página está funcionando. Todavía no hay partidos para mostrar.</p>
    </div>
  </div>
{% endif %}

{# =======================
   SECCIÓN 2: PARTIDOS DE TORNEO
   ======================= #}
{% set _torneos = (items|selectattr('tipo','equalto','TORNEO')|list) if items is defined else [] %}

{% if _torneos and _torneos|length > 0 %}
  <h3 style="margin:14px 0 6px;">Partidos de Torneo</h3>
  <div class="card pad-0">
    <div class="table-wrap">
      <table class="list">
        <thead>
          <tr>
            <th>Evento</th>
            <th>Lado A</th>
            <th>Lado B</th>
            <th>Fecha</th>
            <th>Estado</th>
            <th>Cancha</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for it in _torneos %}
            <tr>
              <td>
                <span class="badge" style="background:#2363eb; border-color:#2363eb;">Torneo</span>
                {{ it.torneo_nombre or 'Torneo' }}
                {% if it.ronda %}<span class="muted"> · {{ it.ronda }}</span>{% endif %}
              </td>
              <td>{{ it.ladoA }}</td>
              <td>{{ it.ladoB }}</td>
              <td>{{ it.programado_en or '-' }}</td>
              <td>
                <span class="badge
                  {% if it.estado == 'JUGADO' %}badge-ok
                  {% elif it.estado in ['PENDIENTE','PROPUESTO','ACEPTADO','POR_CONFIRMAR'] %}badge-warn
                  {% elif it.estado in ['EN_REVISION','CANCELADO','SUSPENDIDO'] %}badge-danger
                  {% endif %}">
                  {{ it.estado }}
                </span>
              </td>
              <td>{{ it.cancha or '-' }}</td>
              <td style="white-space:nowrap;">
                <a href="{{ it.url_detalle }}" class="btn btn-slim">Ver</a>
                {% if it.url_proponer %}<a href="{{ it.url_proponer }}" class="btn-ghost btn-slim">Proponer</a>{% endif %}
                {% if it.url_responder %}<a href="{{ it.url_responder }}" class="btn-ghost btn-slim">Responder</a>{% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
{% endif %}

<!-- ===== JS: contadores de auto-cierre ===== -->
<script>
  (function(){
    const chips = Array.from(document.querySelectorAll('.autocierre-chip'));
    if(!chips.length) return;

    function fmt(ms){
      if(ms <= 0) return 'vencido';
      const s = Math.floor(ms/1000);
      const h = Math.floor(s/3600);
      const m = Math.floor((s%3600)/60);
      if(h > 0) return `${h}h ${m.toString().padStart(2,'0')}m`;
      if(m > 0) return `${m}m`;
      return `${s}s`;
    }

    function tick(){
      const now = Date.now();
      for(const el of chips){
        const proposedMs = Number(el.getAttribute('data-propuesto-ms')) || 0;
        if(!proposedMs) continue;
        const deadline = proposedMs + 12*60*60*1000;
        const remaining = deadline - now;

        if(remaining <= 0){
          el.textContent = 'autocierre pendiente';
          el.classList.add('badge-warn');
          const hint = 'La propuesta ya superó las 12h. Se cerrará automáticamente al refrescar o cuando corra la tarea.';
          el.setAttribute('data-hint', hint);
          el.setAttribute('title', hint);
        } else {
          el.textContent = 'auto-cierra en ' + fmt(remaining);
          const when = new Date(deadline).toLocaleString();
          const hint = 'Auto-cierra el ' + when + ' si nadie rechaza ni confirma.';
          el.setAttribute('data-hint', hint);
          el.setAttribute('title', hint);
          el.classList.remove('badge-warn');
        }
      }
    }

    tick();
    setInterval(tick, 1000);
  })();
</script>
{% endblock %}

{% block help_content %}
<style>
  .help-container{ display:flex; justify-content:center; width:100%; }
  .help-wrap{
    width: min(800px, 90vw);
    margin: 0 auto;
    max-height: 62dvh; max-height: 62vh;
    overflow: auto; overscroll-behavior: contain;
    position: relative; background: transparent;
  }
  .help-head{
    position: sticky; top: 0; z-index: 2;
    display:flex; align-items:center; gap:6px;
    padding:6px 6px; margin-bottom:4px;
    background: var(--bg, rgba(10,12,20,.96));
    border-bottom:1px solid rgba(255,255,255,.06);
  }
  .help-title{ margin:0; font-size: clamp(.92rem, 2vw, 1.02rem); }
  .help-sub{   margin:0; color:var(--muted,#98a2b3); font-size: clamp(.78rem, 1.7vw, .88rem); }
  .help-grid{ display:grid; grid-template-columns: repeat(auto-fit, minmax(236px, 1fr)); gap:8px; }
  .help-card{
    background: rgba(255,255,255,.04);
    border:1px solid rgba(255,255,255,.08);
    border-radius:10px; padding:6px;
  }
  .help-card h4{ display:flex; align-items:center; gap:6px; margin:0 0 4px; font-size: clamp(.88rem, 1.9vw, .96rem); }
  .help-card p, .help-card li{ margin:3px 0; font-size: clamp(.78rem, 1.6vw, .86rem); line-height:1.3; }
  .help-ul{ padding-left:16px; margin:4px 0; }
  .chip{ display:inline-block; padding:2px 7px; border-radius:999px; font-size:.76rem; border:1px solid #2a2f45; background:#1b2138; margin-right:6px;}
  .chip.ok{ background:#1b3b2a; border-color:#1a704d;}
  .chip.info{ background:#1b2f3b; border-color:#1a4d70;}
  .chip.warn{ background:#3b2f1b; border-color:#704d1a;}
  @media (max-width:540px){ .help-grid{ grid-template-columns: 1fr; } .help-card h4 svg{ display:none; } }
</style>

<div class="help-container">
  <div class="help-wrap">
    <div class="help-head">
      <h3 class="help-title">¿Cómo leer y gestionar los partidos?</h3>
      <p class="help-sub">Guía rápida y visual</p>
    </div>

    <div class="help-grid">
      <section class="help-card">
        <h4><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M6 6h12v12H6z" stroke="currentColor"/></svg>¿Qué estás viendo?</h4>
        <p>Un listado de <strong>partidos</strong> con sus parejas, fecha, estado, resultado y acciones según tu rol.</p>
        <div>
          <span class="chip info">Categoría</span>
          <span class="chip ok">Parejas</span>
          <span class="chip warn">Estado</span>
        </div>
      </section>

      <section class="help-card">
        <h4><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M4 6h16M4 12h10M4 18h8" stroke="currentColor"/></svg>Estados y avisos</h4>
        <ul class="help-ul">
          <li><strong>PENDIENTE</strong>: esperando aceptaciones o propuesta de resultado.</li>
          <li><strong>PROPUESTO</strong>/<strong>POR_CONFIRMAR</strong>/<strong>ACEPTADO</strong>: hay propuesta o está listo para proponer/confirmar.</li>
          <li><strong>JUGADO</strong>: resultado confirmado (se muestra ganador y sets).</li>
          <li><strong>EN_REVISION/CANCELADO</strong>: casos especiales moderados por admin.</li>
        </ul>
        <p class="muted">Chips útiles: <em>falta aceptación</em>, <em>falta confirmación</em>, <em>propuesta rechazada</em>, <em>auto-cierra en…</em>.</p>
      </section>

      <section class="help-card">
        <h4><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 2v20M2 12h20" stroke="currentColor"/></svg>Propuesta y confirmación</h4>
        <ul class="help-ul">
          <li>Una pareja <strong>propone</strong> ganador y sets.</li>
          <li>La otra pareja <strong>confirma</strong> o <strong>rechaza</strong>.</li>
          <li>Si hay rechazo, podés <em>re-proponer</em> desde Acciones.</li>
        </ul>
        <p class="muted">La fila muestra quiénes faltan confirmar.</p>
      </section>

      <section class="help-card">
        <h4><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="9" stroke="currentColor"/></svg>Autocierre (12h)</h4>
        <p>Si nadie confirma ni rechaza en 12h desde la propuesta, queda marcado para <strong>autocierre</strong> (contador en vivo).</p>
      </section>

      <section class="help-card">
        <h4><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M6 6h12v12H6z" stroke="currentColor"/></svg>Invitaciones a rivales</h4>
        <p>Si el partido requiere invitación, verás <em>falta aceptación</em> con los nombres pendientes (tooltip).</p>
      </section>

      <section class="help-card">
        <h4><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 2v20M2 12h20" stroke="currentColor"/></svg>Acciones disponibles</h4>
        <ul class="help-ul">
          <li><strong>Participante</strong>: responder invitación, proponer resultado, confirmar/consultar propuesta.</li>
          {% if cj and cj.is_admin %}
            <li><strong>Admin</strong>: además, editar resultados jugados y eliminar partidos.</li>
          {% else %}
            <li class="muted">Las acciones de administración solo las ven los administradores.</li>
          {% endif %}
        </ul>
      </section>
    </div>
  </div>
</div>
{% endblock %}
